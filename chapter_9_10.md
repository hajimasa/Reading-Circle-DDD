# 9-10章

## ファクトリ

## メモ
複雑なオブジェクトの生成処理をオブジェクトとして定義する。
この生成を責務とするオブジェクトのことをファクトリという。

-> コンストラクタに書くごちゃごちゃ書くのは良くなくて、アプリケーションサービスに書くの良くないので、ファクトリとして書く

インスタンスを生成したいときには適当なIDを振り、さもなければデータベース接続して、採番を行えるようにしたいところです。

ゲッターは公開せずに、メソッドでインスタンスを生成して戻り値として返却する

コンストラ他のオブジェクトを生成するかどうか、はファクトリを作る指標になる。

## 質問

Q. ファクトリを使用すると、基本的にはインスタンス生成時に、ファクトリを通るようになる？
新規生成時は、はい
既存の場合は、基本的には通さない

Q. ファクトリの存在を気づかせるためのパッケージに依るグループ分けがわからない
同じディレクトリにファクトリを置くことで、ファクトリの存在に気づかせる

Q
ここらへんがわからん
エンティティは識別子により識別されるオブジェクトです。その識別子が永続化を行うまで存在しないというのは不自然で強烈な制限事項です。誤って識別子が設定されないうちに操作してしまったら、意図しない挙動になるでしょう。開発者は永続化されるまで識別子が生成されないことを常に意識し、細心の注意を払う他ありません。
自動採番による値を識別子として扱ってしまうと、識別子が無い時間が生まれてしまって危ない。

Q. RDBの自動採番機能を使うのであれば、しっかりとルールを周知させる必要がある。ってことは自動採番機能はなるべく採用しないほうが良いということ？
自動採番機能を使うと便利だが、気を使わないといけない。

UUIDをつかう場合
-> 処理的には軽いが、値が長くなる

シーケンステーブルを使う場合

場合に依る

# 整合性

ヘッダとボディが常に互いが存在する一貫性
同時に登録処理を行ってしまうことで、同じユーザー名でユーザーが作られてしまうことがある。

ユニークキー制約による防御
ユニークキー制約によって整合性を保っても、コードからルールを読み取るのは難解

なるべくトランザクションを使おう！

ユニットオブワークとは？
大きい規模のサービスなら有用かも

phpにはAOPが無いらしいじゃないか！

Q. phpでトランザクションは使えるのか？
PDOによるトランザクション？
https://www.php.net/manual/ja/pdo.transactions.php

アプリケーションサービスでDBファサードを使うデメリット
- laravelを使わなくなったときに困る
- 可読性が落ちる

Ray.AOPを使う？
